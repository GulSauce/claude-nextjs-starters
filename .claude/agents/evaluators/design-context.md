# 퀴즈 메타프롬프트 설계 컨텍스트

> 이 문서는 프롬프트 작성자의 **확정된 설계 결정**을 기록합니다.
> 평가 에이전트는:
>
> 1. **평가 시**: 아래 체크리스트(§7)로 프롬프트의 설계 준수 여부를 확인하고 해당 루브릭 항목에 반영하세요.
> 2. **improvedPrompt 작성 시**: 이 결정사항을 번복하거나 변경하지 마세요.

---

## 1. 프롬프트 아키텍처

```
캐시 프롬프트 (강의노트)
  → 시스템 프롬프트 (본 메타프롬프트) ← 평가 대상은 이것
    → 별도 시스템 프롬프트 (JSON 스키마)
      → 유저 메시지 (문항 수)
```

- **평가 대상 프롬프트는 전체가 시스템 프롬프트**임. 유저 메시지 영역이 포함되어 있지 않음
- 강의노트는 **캐시 프롬프트**로 시스템 프롬프트 이전에 제공됨 → 프롬프트 내 강의노트 placeholder 없음
- 문항 수는 **유저 메시지**로 별도 전달됨 → 프롬프트 내 문항 수 placeholder 없음
- JSON 출력 스키마는 **별도 시스템 프롬프트**에서 정의됨 → 프롬프트 내 JSON 스키마 정의 없음

> **CRITICAL — improvedPrompt 작성 시**: 프롬프트를 `--- 시스템 인스트럭션 ---` / `--- 유저 메시지 ---` 두 블록으로 분리하지 마세요. 전체를 **단일 시스템 프롬프트**로 작성하세요. 유저 메시지는 문항 수만 전달하며, 프롬프트 본문에 포함되지 않습니다.

## 2. Placeholder 정책

**Placeholder 0개.** 모든 동적 입력은 외부에서 제공됩니다.

| 입력        | 전달 방식                            | 프롬프트 내 처리                               |
| ----------- | ------------------------------------ | ---------------------------------------------- |
| 강의노트    | 캐시 프롬프트 (시스템 프롬프트 이전) | "강의노트는 캐시 프롬프트로 제공됩니다" 안내만 |
| 문항 수     | 유저 메시지                          | "유저 메시지에서 지정합니다" 안내만            |
| 대상 학습자 | 고정값                               | "대학 학부 수준"                               |
| 평가 목적   | 고정값 (통합 모드)                   | 아래 3번 참조                                  |

**평가 시 주의**: 에이전트가 새 placeholder를 제안하거나 도입하는 것은 금지입니다.

## 3. 통합 평가 모드

형성·총괄·진단 평가의 장점을 **단일 모드로 통합**한 설계입니다. 분기 로직이 없습니다.

| 출처      | 통합된 장점                                       |
| --------- | ------------------------------------------------- |
| 형성 평가 | scaffolding, 오개념 교정 비중 강화 (4단계 해설)   |
| 총괄 평가 | 변별력, 난이도 분포 엄격 준수 (중/상 균등)        |
| 진단 평가 | 오답 3유형 오개념 진단 + 4단계 해설의 단계적 교정 |

**평가 시 주의**: `평가 목적` placeholder나 형성/총괄/진단 분기 로직을 제안하거나 도입하는 것은 금지입니다.

## 4. 고정값 요소

아래 요소는 설계자가 확정한 고정값이며, 변경/파라미터화를 제안하지 마세요:

- **오답 전략**: 3유형(조건 누락형·오개념형·무관 사실형) 균등 배치
- **해설 구조**: 4단계 2계층 분리 — selections[].explanation(1단계 정답 추론 / 2단계 오개념 교정) + explanation(3단계 자기 점검 + 4단계 심화 학습)
- **난이도 배분**: 중/상 균등 (적용~분석 / 분석+평가)
- **대상 학습자**: 대학 학부 수준
- **선택지 수**: 4개 고정
- **정답 위치**: 프롬프트에서 지시하지 않음 (서버에서 선택지 셔플 수행)

## 5. 출력 구조

JSON 스키마 의존성을 최소화하기 위해, 프롬프트에서는 **3개 핵심 필드**만 명시합니다:

- `content` (문제 본문)
- `selections` (선택지 목록 — 각 `content` + `correct` boolean + `explanation` 해당 선택지 해설)
- `explanation` (문항 전체 해설 — 3단계 자기 점검 + 4단계 심화 학습)

**평가 시 주의**: 출력 필드를 세분화하거나 추가 필드를 제안하지 마세요. 스키마는 별도로 관리됩니다.

## 6. 가독성 규칙

content와 explanation 텍스트에 적극적으로 마크다운을 사용합니다:

- `\n` 개행으로 단락 분리
- `**굵게**`: 핵심 개념, 단계 헤더, 정답/오답 라벨
- `` `코드` ``: 기술 용어, 함수명, 명령어
- 테이블: 비교/대조 (오답 교정 등)
- 번호/불릿 목록, `>` 인용 (근거 출처)

---

## 7. 설계 준수 평가 체크리스트

> 각 항목을 확인하고, **위반 시 해당 루브릭 항목에서 감점**하세요.
> 준수 시에는 해당 루브릭의 feedback에 긍정적으로 언급하세요.

### 아키텍처 준수 → `clarity` 반영

| #   | 체크 항목                                                                         | 위반 예시                                                        |
| --- | --------------------------------------------------------------------------------- | ---------------------------------------------------------------- |
| A1  | placeholder가 0개인가? `{...}` 형태의 삽입 위치가 없어야 함                       | `{강의노트 삽입 위치}`, `{문항 수 삽입 위치}` 등이 남아있음      |
| A2  | 강의노트를 "캐시 프롬프트로 제공된다"고 안내하는가?                               | 강의노트 삽입 블록(`=== 강의노트 시작 ===`)이 존재               |
| A3  | 문항 수를 "유저 메시지에서 지정한다"고 안내하는가?                                | 문항 수 기본값/자동 결정 로직이 프롬프트에 포함                  |
| A4  | JSON 출력 스키마를 프롬프트 내에 직접 정의하지 않는가?                            | 프롬프트에 JSON 필드 상세 스키마가 포함                          |
| A5  | 프롬프트 전체가 단일 시스템 프롬프트인가? 유저 메시지 블록으로 분리하지 않았는가? | `--- 유저 메시지 시작 ---` 등의 구분자로 시스템/유저 영역을 분리 |

### 통합 모드 준수 → `clarity`, `difficulty_control` 반영

| #   | 체크 항목                                                | 위반 예시                                                |
| --- | -------------------------------------------------------- | -------------------------------------------------------- |
| B1  | 평가 목적이 고정(통합 모드)인가? placeholder나 분기 없음 | `{평가 목적 삽입 위치}`, `형성 평가인 경우...` 분기 존재 |
| B2  | 형성·총괄·진단의 장점이 통합되어 반영되었는가?           | scaffolding 없음, 오개념 진단 구조 없음                  |
| B3  | 대상 학습자가 "대학 학부 수준"으로 고정인가?             | `{학과/학년 삽입 위치}` placeholder 존재                 |

### 고정값 준수 → `difficulty_control`, `answer_quality` 반영

| #   | 체크 항목                                                                                      | 위반 예시                                                                          |
| --- | ---------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------- |
| C1  | 오답 3유형(조건 누락형·오개념형·무관 사실형) 균등 배치가 명시되었는가?                         | 오답 유형이 2개만 있거나, 유형 비율이 자유                                         |
| C2  | 4단계 해설이 2계층으로 분리되었는가? (selections[].explanation: 1~2단계, explanation: 3~4단계) | 4단계가 단일 텍스트에 통합, 또는 단계 구조 없음                                    |
| C3  | 난이도 중/상 균등 배분이 명시되었는가?                                                         | 난이도 배분이 자유이거나 특정 난이도 편중                                          |
| C4  | 선택지 4개 고정이 명시되었는가?                                                                | 선택지 수가 가변적                                                                 |
| C5  | 정답 위치 분산/균등 배치를 프롬프트에서 지시하지 **않는가**?                                   | "정답 위치를 분산하세요", "A/B/C/D 균등 분배" 등 존재 (서버에서 셔플하므로 불필요) |

### 출력 구조 준수 → `model_optimization` 반영

| #   | 체크 항목                                                                          | 위반 예시                                                 |
| --- | ---------------------------------------------------------------------------------- | --------------------------------------------------------- |
| D1  | 출력 필드를 `content`, `selections`, `explanation` 3개로만 명시하는가?             | 13개 이상 상세 필드 정의, JSON 스키마 중복                |
| D2  | selections의 구조가 `content` + `correct`(boolean) + `explanation`으로 안내되는가? | 선택지 라벨(A/B/C/D)을 별도 필드로 정의, explanation 누락 |
| D3  | "JSON 스키마는 별도 시스템 프롬프트에서 정의"라고 명시하는가?                      | 프롬프트 내 완전한 JSON 스키마 포함                       |

### 가독성 규칙 준수 → `answer_quality`, `model_optimization` 반영

| #   | 체크 항목                                                                                 | 위반 예시                                                                  |
| --- | ----------------------------------------------------------------------------------------- | -------------------------------------------------------------------------- |
| E1  | content/explanation에 개행(`\n`) 사용을 지시하는가?                                       | 가독성 지시 없음, 한 줄짜리 출력만 예시                                    |
| E2  | 마크다운(`**굵게**`, 불릿, `>` 인용) 활용을 지시하는가?                                   | 플레인 텍스트만 예시                                                       |
| E3  | `` `코드` `` 스페이스 사용을 지시하는가? (기술 용어 등)                                   | 기술 용어를 일반 텍스트로만 처리                                           |
| E4  | 테이블 마크다운 사용을 지시하는가? (비교/대조)                                            | 비교 항목을 나열형으로만 처리                                              |
| E5  | 참고 예시가 위 가독성 규칙을 실제로 시연하는가? (content 테이블, explanation 마크다운 등) | 예시가 규칙과 불일치 (예: 테이블 지시가 있으나 예시 content에 테이블 없음) |
